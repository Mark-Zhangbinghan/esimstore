# eSIM 在线售卖平台
## 需求规格说明书

| 项目     | 内容        |
| -------- | ----------- |
| 项目名称 | eSIM Store  |
| 版本     | v1.0        |
| 作者     | e脉相传团队 |
| 日期     | 2025-11-08  |

---

## 1. 引言

### 1.1 目的
本文档定义 eSIM Store 系统的功能、性能、接口及约束，为设计、开发、测试、验收提供唯一依据。

### 1.2 适用范围
- 前端：Vue3 单页应用  
- 后端：Django REST API  
- 管理端：基于 Element-Plus 的后台  
- 第三方：支付宝/微信沙箱、运营商 SM-DP+ 模拟接口

---

## 2. 术语

| 术语     | 说明                                                        |
| -------- | ----------------------------------------------------------- |
| eSIM     | 嵌入式 SIM，通过二维码远程下载配置文件                      |
| SM-DP+   | Subscription Manager Data Preparation，运营商配置文件服务器 |
| 子二维码 | 家庭共享场景下，一个订单派生的多张可激活二维码              |

---

## 3. 用户特征

| 角色   | 描述               | 比例 |
| ------ | ------------------ | ---- |
| 游客   | 未注册，可浏览套餐 | 40%  |
| 买家   | 注册并购买         | 55%  |
| 运营商 | 上传套餐、查看销量 | 5%   |

---

## 4. 功能性需求

### 4.1 游客模块
- FR-T1：按国家/地区过滤套餐  
- FR-T2：实时显示库存、价格、有效期

### 4.2 用户模块
- FR-U1：邮箱+验证码注册（含重发冷却 60s）  
- FR-U2：JWT 登录，Token 有效期 24h  
- FR-U3：个人中心展示订单列表、激活状态

### 4.3 订单模块
- FR-O1：创建订单 → 锁定库存 15 分钟  
- FR-O2：支付宝/微信沙箱支付（统一封装 PayService）  
- FR-O3：支付成功回调 → 调用 SM-DP+ 获取二维码 → 生成 PNG → 返回下载链接  
- FR-O4：激活失败自动退款（定时任务扫描「未激活 & 超过 2h」订单，调用撤销接口）

### 4.4 家庭共享
- FR-F1：订单支持「购买份数」≤5  
- FR-F2：每份生成独立子二维码（ICCID 不同）  
- FR-F3：子码可单独下载、转发微信

### 4.5 管理后台
- FR-A1：运营商登录（白名单机制）  
- FR-A2：套餐 CRUD（名称、价格、天数、国家、库存、封面图）  
- FR-A3：订单明细导出 CSV  
- FR-A4：Dashboard 销量折线图（按日/周/月）

---

## 5. 非功能性需求

| 类型 | 要求                                         |
| ---- | -------------------------------------------- |
| 性能 | 二维码生成 ≤ 3s；支付接口 99.9% 可用         |
| 安全 | HTTPS、JWT、二维码链接签名验证、退款接口幂等 |
| 兼容 | 支持 iOS 12+、Android 10+ 原生 eSIM 激活向导 |
| 扩展 | 水平扩展：无状态 API + Redis 共享会话        |
| 法规 | 遵循《电子商务法》《网络交易监督管理办法》   |

---

## 6. 验收标准

| 场景     | 标准                                    |
| -------- | --------------------------------------- |
| 游客浏览 | 可 2 步内到达任意国家套餐页             |
| 购买     | 从点击「立即购买」到出现二维码 ≤ 30s    |
| 退款     | 激活失败订单 30s 内原路退回（沙箱环境） |
| 并发     | 50 并发下单，库存扣减正确，无超卖       |

---

## 7. 风险与假设

- 假设：运营商 SM-DP+ 接口在测试阶段提供 99% 可用率  
- 风险：微信/支付宝沙箱回调延迟 → 预留 5 分钟重试机制  
- 风险：二维码被转发滥用 → 链接有效期 24h + 签名验证

---

文档作者：张秉瀚
评审：全员 
发布日期：2025-11-08
下次迭代：原型评审后 → v1.1